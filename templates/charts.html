{% extends "base.html" %}

{% block title %}ðŸ“Š CryptoPulse Charts{% endblock %}

{% block content %}
<div class="header">
  <h1>ðŸ“ˆ Cryptocurrency Charts</h1>
  <p>Interactive visualizations of real-time market data</p>
</div>

<!-- Chart containers -->
<div class="chart-grid">
  <div class="chart-card">
    <canvas id="priceChart"></canvas>
  </div>
  <div class="chart-card">
    <canvas id="volumeChart"></canvas>
  </div>
  <div class="chart-card">
    <canvas id="changeChart"></canvas>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Data passed from Flask backend ---
  const chartData = {{ chart_data | tojson }};
  console.log("Chart data:", chartData); // âœ… Debug info

  const names = chartData.names;
  const prices = chartData.prices;
  const volumes = chartData.volumes;
  const changes = chartData.changes;

  // --- Shared chart style ---
  const baseOptions = {
    responsive: true,
    plugins: {
      legend: { display: false },
      title: { font: { size: 18 } }
    }
  };

  // --- Chart 1: Prices ---
  new Chart(document.getElementById("priceChart"), {
    type: "bar",
    data: {
      labels: names,
      datasets: [{
        label: "Price (USD)",
        data: prices,
        backgroundColor: "rgba(56, 189, 248, 0.5)",
        borderColor: "#38bdf8",
        borderWidth: 2
      }]
    },
    options: {
      ...baseOptions,
      plugins: {
        ...baseOptions.plugins,
        title: { display: true, text: "ðŸ’° Current Prices (USD)" }
      },
      scales: { y: { beginAtZero: false } }
    }
  });

  // --- Chart 2: Volume ---
  new Chart(document.getElementById("volumeChart"), {
    type: "line",
    data: {
      labels: names,
      datasets: [{
        label: "24h Volume (USD)",
        data: volumes,
        borderColor: "#22c55e",
        backgroundColor: "rgba(34,197,94,0.2)",
        borderWidth: 2,
        tension: 0.3,
        fill: true
      }]
    },
    options: {
      ...baseOptions,
      plugins: {
        ...baseOptions.plugins,
        title: { display: true, text: "ðŸ“Š 24h Trading Volume" }
      },
      scales: { y: { beginAtZero: true } }
    }
  });

  // --- Chart 3: Price Change ---
  new Chart(document.getElementById("changeChart"), {
    type: "bar",
    data: {
      labels: names,
      datasets: [{
        label: "24h Change (%)",
        data: changes,
        backgroundColor: changes.map(v => v >= 0 ? "rgba(34,197,94,0.5)" : "rgba(239,68,68,0.5)"),
        borderColor: changes.map(v => v >= 0 ? "#22c55e" : "#ef4444"),
        borderWidth: 2
      }]
    },
    options: {
      ...baseOptions,
      plugins: {
        ...baseOptions.plugins,
        title: { display: true, text: "ðŸ“ˆ 24h Price Change (%)" }
      },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
